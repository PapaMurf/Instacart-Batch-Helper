<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Batch Profit Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
      --warning: #facc15;
      --success: #4ade80;
      --border-subtle: #1f2937;
      --radius-lg: 18px;
      --radius-pill: 999px;
      --shadow-soft: 0 14px 40px rgba(0, 0, 0, 0.55);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 60%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    .app-wrapper {
      max-width: 480px;
      width: 100%;
      min-height: 100vh;
      padding: 16px 16px 24px;
    }

    .card {
      background: radial-gradient(circle at top left, #0b1120, var(--card-bg));
      border-radius: var(--radius-lg);
      padding: 16px 16px 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.15);
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }

    .app-title {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .app-title span.accent {
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--accent);
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      background: var(--accent-soft);
    }

    .subtext {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .section-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .input-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .field input {
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 10px 10px 9px;
      font-size: 0.9rem;
      outline: none;
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
    }

    .field input::placeholder {
      color: #4b5563;
    }

    .field input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    .inline-prefix {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 9px 10px 8px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
    }

    .inline-prefix span {
      font-size: 0.85rem;
      color: #64748b;
    }

    .inline-prefix input {
      border: none;
      background: transparent;
      padding: 0;
      box-shadow: none;
    }

    .actions-row {
      display: flex;
      gap: 8px;
      margin: 10px 0 4px;
    }

    button {
      border: none;
      cursor: pointer;
      font-family: inherit;
    }

    #calculateBtn {
      flex: 1.4;
      padding: 12px 14px;
      border-radius: var(--radius-pill);
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      font-weight: 600;
      font-size: 0.95rem;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 10px 25px rgba(21, 128, 61, 0.5);
    }

    #calculateBtn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(21, 128, 61, 0.6);
    }

    .secondary-btn {
      flex: 1;
      padding: 10px 12px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.85);
      color: #9ca3af;
      font-size: 0.8rem;
      border: 1px solid var(--border-subtle);
    }

    .secondary-btn:active {
      transform: translateY(1px);
      background: rgba(17, 24, 39, 0.95);
    }

    .summary-card {
      margin-top: 10px;
      padding: 12px 12px 10px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .summary-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #9ca3af;
    }

    .pill {
      padding: 3px 10px;
      border-radius: var(--radius-pill);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .pill-take {
      background: rgba(34, 197, 94, 0.1);
      color: var(--success);
      border: 1px solid rgba(34, 197, 94, 0.4);
    }

    .pill-maybe {
      background: rgba(250, 204, 21, 0.08);
      color: var(--warning);
      border: 1px solid rgba(250, 204, 21, 0.4);
    }

    .pill-skip {
      background: rgba(248, 113, 113, 0.08);
      color: var(--danger);
      border: 1px solid rgba(248, 113, 113, 0.4);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 10px;
      margin-top: 4px;
    }

    .summary-item {
      font-size: 0.78rem;
      color: #e5e7eb;
    }

    .summary-item span.label {
      display: block;
      font-size: 0.72rem;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 1px;
    }

    .settings-card {
      margin-top: 16px;
      padding: 12px 12px 10px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.8);
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    .settings-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: #9ca3af;
    }

    .toggle-btn {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.9);
      color: #9ca3af;
      border: 1px solid var(--border-subtle);
    }

    .toggle-btn.active {
      color: var(--accent);
      border-color: rgba(56, 189, 248, 0.7);
      background: rgba(15, 23, 42, 1);
    }

    .settings-body {
      margin-top: 8px;
      display: none;
    }

    .settings-body.open {
      display: block;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 10px;
    }

    .settings-note {
      margin-top: 8px;
      font-size: 0.7rem;
      color: #6b7280;
    }

    .tiny {
      font-size: 0.7rem;
      color: #4b5563;
      margin-top: 6px;
      text-align: right;
    }

    .error-text {
      font-size: 0.72rem;
      color: var(--danger);
      margin-top: 4px;
    }

    @media (max-width: 400px) {
      .input-row {
        grid-template-columns: 1fr;
      }

      .settings-grid {
        grid-template-columns: 1fr;
      }

      #calculateBtn {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-wrapper">
    <div class="card">
      <header class="app-header">
        <div>
          <div class="app-title">
            <span>Batch Calc</span>
            <span class="accent">Instacart</span>
          </div>
          <div class="subtext">Quick check before the batch disappears.</div>
        </div>
      </header>

      <div class="section-label">Batch inputs</div>
      <div class="input-row">
        <div class="field">
          <label for="batchPay">Batch Pay</label>
          <div class="inline-prefix">
            <span>$</span>
            <input
              id="batchPay"
              type="number"
              inputmode="decimal"
              step="0.01"
              placeholder="0.00"
            />
          </div>
        </div>

        <div class="field">
          <label for="mileage">Miles (one-way)</label>
          <input
            id="mileage"
            type="number"
            inputmode="decimal"
            step="0.1"
            placeholder="0"
          />
        </div>

        <div class="field">
          <label for="items">Items</label>
          <input
            id="items"
            type="number"
            inputmode="numeric"
            step="1"
            placeholder="0"
          />
        </div>
      </div>

      <div class="actions-row">
        <button id="calculateBtn">
          <span>Calculate</span>
          <span>➜</span>
        </button>
        <button id="clearBtn" class="secondary-btn">Clear batch</button>
      </div>
      <div id="errorMsg" class="error-text" style="display:none;"></div>

      <div id="summaryCard" class="summary-card" style="display:none;">
        <div class="summary-header">
          <div class="summary-title">Summary</div>
          <div id="recommendationPill" class="pill pill-maybe">Maybe</div>
        </div>
        <div class="summary-grid">
          <div class="summary-item">
            <span class="label">Net earnings</span>
            <span id="netEarnings">$0.00</span>
          </div>
          <div class="summary-item">
            <span class="label">Est. time</span>
            <span id="estTime">0 min</span>
          </div>
          <div class="summary-item">
            <span class="label">Earnings / hr</span>
            <span id="earnPerHour">$0.00/hr</span>
          </div>
          <div class="summary-item">
            <span class="label">Earnings / mile</span>
            <span id="earnPerMile">$0.00/mi</span>
          </div>
        </div>
      </div>

      <div class="settings-card">
        <div class="settings-header">
          <div class="settings-title">Settings</div>
          <button id="toggleSettings" class="toggle-btn">Show</button>
        </div>
        <div id="settingsBody" class="settings-body">
          <div class="settings-grid">
            <div class="field">
              <label for="gasPrice">Gas price (per gallon)</label>
              <div class="inline-prefix">
                <span>$</span>
                <input
                  id="gasPrice"
                  type="number"
                  inputmode="decimal"
                  step="0.01"
                  placeholder="3.50"
                />
              </div>
            </div>

            <div class="field">
              <label for="mpg">Car MPG</label>
              <input
                id="mpg"
                type="number"
                inputmode="decimal"
                step="0.1"
                placeholder="25"
              />
            </div>

            <div class="field">
              <label for="targetHourly">Target hourly rate</label>
              <div class="inline-prefix">
                <span>$</span>
                <input
                  id="targetHourly"
                  type="number"
                  inputmode="decimal"
                  step="1"
                  placeholder="25"
                />
              </div>
            </div>

            <div class="field">
              <label for="baseMinutes">Base minutes per batch</label>
              <input
                id="baseMinutes"
                type="number"
                inputmode="numeric"
                step="1"
                placeholder="15"
              />
            </div>

            <div class="field">
              <label for="minutesPerItem">Minutes per item</label>
              <input
                id="minutesPerItem"
                type="number"
                inputmode="decimal"
                step="0.1"
                placeholder="1"
              />
            </div>

            <div class="field">
              <label for="minutesPerMile">Minutes per mile (one-way)</label>
              <input
                id="minutesPerMile"
                type="number"
                inputmode="decimal"
                step="0.1"
                placeholder="2"
              />
            </div>
          </div>

          <div class="settings-note">
            • Time uses <strong>one-way miles</strong> only.<br />
            • Fuel cost uses a <strong>round trip (2× miles)</strong> with
            gas price &amp; MPG to approximate real fuel spend.<br />
            Settings are saved on this device using local storage.
          </div>
        </div>
        <div class="tiny">v2 • All calculations are estimates only.</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // v2 settings include gas price + MPG
      const DEFAULT_SETTINGS = {
        gasPrice: 3.5,       // $ per gallon
        mpg: 25,             // miles per gallon
        targetHourly: 25,
        baseMinutes: 15,
        minutesPerItem: 1,
        minutesPerMile: 2,
      };

      const SETTINGS_KEY = "batchCalcSettings_v2";

      const batchPayInput = document.getElementById("batchPay");
      const mileageInput = document.getElementById("mileage");
      const itemsInput = document.getElementById("items");

      const gasPriceInput = document.getElementById("gasPrice");
      const mpgInput = document.getElementById("mpg");
      const targetHourlyInput = document.getElementById("targetHourly");
      const baseMinutesInput = document.getElementById("baseMinutes");
      const minutesPerItemInput = document.getElementById("minutesPerItem");
      const minutesPerMileInput = document.getElementById("minutesPerMile");

      const calculateBtn = document.getElementById("calculateBtn");
      const clearBtn = document.getElementById("clearBtn");
      const summaryCard = document.getElementById("summaryCard");
      const recommendationPill = document.getElementById("recommendationPill");
      const netEarningsSpan = document.getElementById("netEarnings");
      const estTimeSpan = document.getElementById("estTime");
      const earnPerHourSpan = document.getElementById("earnPerHour");
      const earnPerMileSpan = document.getElementById("earnPerMile");
      const errorMsg = document.getElementById("errorMsg");

      const toggleSettingsBtn = document.getElementById("toggleSettings");
      const settingsBody = document.getElementById("settingsBody");

      function loadSettings() {
        try {
          const raw = localStorage.getItem(SETTINGS_KEY);
          if (!raw) {
            applySettings(DEFAULT_SETTINGS);
            saveSettings(DEFAULT_SETTINGS);
            return;
          }
          const parsed = JSON.parse(raw);
          const s = { ...DEFAULT_SETTINGS, ...parsed };
          applySettings(s);
        } catch (e) {
          applySettings(DEFAULT_SETTINGS);
        }
      }

      function applySettings(s) {
        gasPriceInput.value = s.gasPrice;
        mpgInput.value = s.mpg;
        targetHourlyInput.value = s.targetHourly;
        baseMinutesInput.value = s.baseMinutes;
        minutesPerItemInput.value = s.minutesPerItem;
        minutesPerMileInput.value = s.minutesPerMile;
      }

      function saveSettings(s) {
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(s));
      }

      function saveSettingsFromInputs() {
        const s = {
          gasPrice: parseFloat(gasPriceInput.value) || DEFAULT_SETTINGS.gasPrice,
          mpg: parseFloat(mpgInput.value) || DEFAULT_SETTINGS.mpg,
          targetHourly:
            parseFloat(targetHourlyInput.value) || DEFAULT_SETTINGS.targetHourly,
          baseMinutes:
            parseFloat(baseMinutesInput.value) || DEFAULT_SETTINGS.baseMinutes,
          minutesPerItem:
            parseFloat(minutesPerItemInput.value) ||
            DEFAULT_SETTINGS.minutesPerItem,
          minutesPerMile:
            parseFloat(minutesPerMileInput.value) ||
            DEFAULT_SETTINGS.minutesPerMile,
        };
        saveSettings(s);
        return s;
      }

      function formatCurrency(value) {
        if (!isFinite(value)) return "$0.00";
        const sign = value < 0 ? "-" : "";
        const abs = Math.abs(value).toFixed(2);
        return sign + "$" + abs;
      }

      function calculate() {
        errorMsg.style.display = "none";
        errorMsg.textContent = "";

        const batchPay = parseFloat(batchPayInput.value);
        const mileage = parseFloat(mileageInput.value);
        const items = parseFloat(itemsInput.value);

        if (isNaN(batchPay) || isNaN(mileage) || isNaN(items)) {
          errorMsg.textContent =
            "Enter batch pay, one-way miles, and item count to calculate.";
          errorMsg.style.display = "block";
          summaryCard.style.display = "none";
          return;
        }

        const settings = saveSettingsFromInputs();
        const gasPrice = settings.gasPrice;
        const mpg = settings.mpg;
        const targetHr = settings.targetHourly;
        const baseMin = settings.baseMinutes;
        const minPerItem = settings.minutesPerItem;
        const minPerMile = settings.minutesPerMile;

        // Time uses one-way miles
        const estMinutes =
          baseMin + minPerItem * items + minPerMile * mileage;

        if (estMinutes <= 0) {
          errorMsg.textContent =
            "Estimated time must be greater than zero. Check your settings.";
          errorMsg.style.display = "block";
          summaryCard.style.display = "none";
          return;
        }

        // Fuel cost uses round-trip distance (2x one-way mileage)
        const effectiveMpg = mpg > 0 ? mpg : DEFAULT_SETTINGS.mpg;
        const gasCostPerMile = gasPrice / effectiveMpg;
        const roundTripMiles = mileage * 2;
        const fuelCost = roundTripMiles * gasCostPerMile;

        const net = batchPay - fuelCost;
        const hours = estMinutes / 60;
        const earningsPerHour = net / hours;
        const earningsPerMile =
          mileage > 0 ? net / mileage : Number.POSITIVE_INFINITY;

        netEarningsSpan.textContent = formatCurrency(net);
        estTimeSpan.textContent =
          estMinutes.toFixed(0) +
          " min (" +
          hours.toFixed(2) +
          " hr)";
        earnPerHourSpan.textContent = formatCurrency(earningsPerHour) + "/hr";

        if (!isFinite(earningsPerMile)) {
          earnPerMileSpan.textContent = "—";
        } else {
          earnPerMileSpan.textContent =
            formatCurrency(earningsPerMile) + "/mi";
        }

        let pillClass = "pill-maybe";
        let label = "Maybe";

        if (earningsPerHour >= targetHr) {
          pillClass = "pill-take";
          label = "Take";
        } else if (earningsPerHour >= targetHr * 0.85) {
          pillClass = "pill-maybe";
          label = "Maybe";
        } else {
          pillClass = "pill-skip";
          label = "Skip";
        }

        recommendationPill.className = "pill " + pillClass;
        recommendationPill.textContent = label;

        summaryCard.style.display = "block";
      }

      function clearBatch() {
        batchPayInput.value = "";
        mileageInput.value = "";
        itemsInput.value = "";
        summaryCard.style.display = "none";
        errorMsg.style.display = "none";
      }

      function toggleSettings() {
        const open = settingsBody.classList.toggle("open");
        toggleSettingsBtn.classList.toggle("active", open);
        toggleSettingsBtn.textContent = open ? "Hide" : "Show";
      }

      gasPriceInput.addEventListener("change", saveSettingsFromInputs);
      mpgInput.addEventListener("change", saveSettingsFromInputs);
      targetHourlyInput.addEventListener("change", saveSettingsFromInputs);
      baseMinutesInput.addEventListener("change", saveSettingsFromInputs);
      minutesPerItemInput.addEventListener("change", saveSettingsFromInputs);
      minutesPerMileInput.addEventListener("change", saveSettingsFromInputs);

      calculateBtn.addEventListener("click", calculate);
      clearBtn.addEventListener("click", clearBatch);
      toggleSettingsBtn.addEventListener("click", toggleSettings);

      // Allow pressing Enter to calculate from any batch input
      [batchPayInput, mileageInput, itemsInput].forEach((input) => {
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            calculate();
          }
        });
      });

      loadSettings();

      // Focus first field for speed
      setTimeout(() => {
        batchPayInput.focus();
      }, 150);
    })();
  </script>
</body>
</html>
